name: Release V6 Engine

on:
  push:
    tags:
      - 'v*'

jobs:
  release:
    runs-on: windows-latest

    steps:
      # Checkout repo
      - name: Checkout source
        uses: actions/checkout@v4

      # Install MSBuild (for .NET Framework builds)
      - name: Setup MSBuild
        uses: microsoft/setup-msbuild@v2

      # Install NuGet
      - name: Setup NuGet
        uses: NuGet/setup-nuget@v2

      # Restore packages
      - name: Restore NuGet
        run: nuget restore GJames.V6.ExtensionEngine.Demo.sln

      # Build ALL projects
      - name: Build (Release)
        run: msbuild GJames.V6.ExtensionEngine.Demo.sln /p:Configuration=Release /m

      # Upload DLLs to RELEASE PAGE
      - name: Upload DLL assets
        uses: softprops/action-gh-release@v1
        with:
          files: |
            src/GJames.Engine.Contracts/bin/Release/*.dll
            src/GJames.Engine.Core/bin/Release/*.dll
            src/GJames.Engine.Infrastructure/bin/Release/*.dll
            src/GJames.Engine.DataProviders/bin/Release/*.dll
            src/GJames.Engine.Rules/bin/Release/*.dll
            src/GJames.V6.Adapter/bin/Release/*.dll
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
